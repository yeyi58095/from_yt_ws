#!/usr/bin/env python3
import rospy
import actionlib
from move_base_msgs.msg import MoveBaseAction, MoveBaseGoal

class NavController:
    def __init__(self):
        self.client = actionlib.SimpleActionClient('move_base', MoveBaseAction)
        rospy.loginfo("ç­‰å¾… move_base action server...")
        self.client.wait_for_server()
        rospy.loginfo("å·²é€£æ¥åˆ° move_base")

    def go_to(self, pose):  # pose = dict with x, y, z, qx, qy, qz, qw
        goal = MoveBaseGoal()
        goal.target_pose.header.frame_id = "map"
        goal.target_pose.header.stamp = rospy.Time.now()

        goal.target_pose.pose.position.x = pose["x"]
        goal.target_pose.pose.position.y = pose["y"]
        goal.target_pose.pose.position.z = pose["z"]

        goal.target_pose.pose.orientation.x = pose["qx"]
        goal.target_pose.pose.orientation.y = pose["qy"]
        goal.target_pose.pose.orientation.z = pose["qz"]
        goal.target_pose.pose.orientation.w = pose["qw"]

        self.client.send_goal(goal)
        rospy.loginfo("ğŸš€ ç™¼é€å°èˆªç›®æ¨™")

    def cancel(self):
        self.client.cancel_goal()
        rospy.logwarn("âš ï¸ å·²å–æ¶ˆç•¶å‰ç›®æ¨™")

    def wait(self):
        self.client.wait_for_result()
        state = self.client.get_state()
        return state


   from actionlib_msgs.msg import GoalStatus

    def wait(self):
    self.client.wait_for_result()
    state = self.client.get_state()
    if state == GoalStatus.SUCCEEDED:
        rospy.loginfo("âœ… å·²æˆåŠŸåˆ°é”ç›®æ¨™ï¼")
    elif state == GoalStatus.PREEMPTED:
        rospy.logwarn("âš ï¸ å°èˆªå·²è¢«ä¸­æ–· (PREEMPTED)")
    elif state == GoalStatus.ABORTED:
        rospy.logerr("âŒ å°èˆªå¤±æ•— (ABORTED)")
    else:
        rospy.logwarn(f"âš ï¸ æœªçŸ¥ç‹€æ…‹çµæŸï¼Œstate={state}")
    return state

